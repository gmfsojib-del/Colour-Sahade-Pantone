<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raha Digital Print - Final Fixed</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
    <style>
        :root { --primary: #1a237e; --secondary: #2e7d32; --ai-color: #00695c; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        .sidebar-nav { width: 280px; background: #fff; height: 100vh; border-right: 2px solid #ddd; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .nav-item { padding: 12px; margin-bottom: 8px; border-radius: 8px; cursor: pointer; color: #333; font-weight: 600; border: 1px solid #eee; transition: 0.2s; text-align: center; }
        .nav-item:hover { background: var(--primary); color: white; }

        /* Main Content */
        .main-wrapper { flex: 1; padding: 25px; box-sizing: border-box; overflow-y: auto; position: relative; }
        .box { padding: 20px; border: 2px solid #ddd; border-radius: 12px; background: #fff; text-align: center; margin-bottom: 20px; }

        /* Inputs */
        .rgb-inputs { display: flex; justify-content: center; gap: 10px; margin: 15px 0; }
        .rgb-field { width: 70px; padding: 10px; border: 2px solid #ccc; border-radius: 8px; text-align: center; font-weight: bold; }
        .btn { padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; text-transform: uppercase; transition: 0.3s; }
        .btn-update { background: var(--primary); color: white; }
        .btn-save { background: var(--secondary); color: white; width: 100%; font-size: 18px; margin-top: 15px; }

        /* Download Area Fix */
        #captureArea { background: #fff; padding: 30px; border: 1px solid #ddd; border-radius: 12px; width: 100%; box-sizing: border-box; display: inline-block; }
        .palette-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 12px; margin-top: 20px; }
        .color-card { border: 1px solid #000; background: #fff; border-radius: 8px; overflow: hidden; }
        .color-swatch { height: 70px; width: 100%; border-bottom: 1px solid #000; }
        .color-info { padding: 5px; font-size: 11px; font-weight: bold; text-align: center; color: #000; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-content { background: white; margin: 5% auto; padding: 25px; width: 85%; max-width: 900px; border-radius: 15px; max-height: 80vh; overflow-y: auto; position: relative; }
        .close-btn { position: absolute; right: 20px; top: 15px; font-size: 28px; cursor: pointer; }
        .hunt-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .hunt-card { height: 160px; border-radius: 10px; overflow: hidden; border: 1px solid #ddd; cursor: pointer; display: flex; flex-direction: column; }
        .c-layer { height: 25%; width: 100%; }

        #imageCanvas { max-width: 100%; cursor: crosshair; border: 2px solid #333; margin-top: 10px; }
        .copy-toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 12px 25px; border-radius: 30px; display: none; z-index: 3000; }
    </style>
</head>
<body>

<div class="sidebar-nav">
    <h2 style="text-align: center; color: var(--primary);">RAHA DESIGN</h2>
    <hr>
    <div id="categoryMenu"></div>
</div>

<div class="main-wrapper">
    <div class="box">
        <label><b>1. PHOTO PICKER / MANUAL INPUT</b></label>
        <input type="file" id="upload" accept="image/*" style="display:block; margin: 10px auto;">
        <div class="rgb-inputs">
            <input type="number" id="r" class="rgb-field" placeholder="R" value="26">
            <input type="number" id="g" class="rgb-field" placeholder="G" value="35">
            <input type="number" id="b" class="rgb-field" placeholder="B" value="126">
            <button class="btn btn-update" onclick="generateFromInputs()">GENERATE</button>
        </div>
        <canvas id="imageCanvas"></canvas>
    </div>

    <div id="captureArea">
        <h3 style="text-align: center; color: var(--primary); margin: 0;">Premium Digital Palette - HD</h3>
        <div id="palette" class="palette-grid"></div>
    </div>

    <button class="btn btn-save" onclick="downloadHD()">SAVE AS IMAGE (300 DPI)</button>
</div>

<div id="huntModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle" style="color: var(--primary);">Color Hunt</h2>
        <div id="huntGrid" class="hunt-grid"></div>
    </div>
</div>

<div id="copyToast" class="copy-toast">Copied!</div>

<script>
    const canvas = document.getElementById('imageCanvas');
    const ctx = canvas.getContext('2d');
    const rIn = document.getElementById('r'), gIn = document.getElementById('g'), bIn = document.getElementById('b');

    // ১. আপনার সম্পূর্ণ Hunt Data
    const categories = ["Pastel", "Vintage", "Retro", "Neon", "Gold", "Nature", "Summer", "Happy", "Night", "Earth"];
    const huntData = {
        'Pastel': [['#FFB7B2', '#FFDAC1', '#E2F0CB', '#B5EAD7'], ['#F3E5F5', '#E1F5FE', '#E8F5E9', '#FFFDE7'], ['#B2F7EF', '#EFF7F6', '#F7D1CD', '#E2CFC4']],
        'Vintage': [['#634832', '#967E67', '#D4A373', '#FEFAE0'], ['#264653', '#2A9D8F', '#E9C46A', '#F4A261']],
        'Neon': [['#00F5FF', '#00FF41', '#FF00FF', '#FFFF00'], ['#FF3131', '#FF5E13', '#77EE11', '#08F7FE']],
        'Gold': [['#D4AF37', '#FFD700', '#CFB53B', '#F5E1A4'], ['#BF953F', '#FCF6BA', '#B38728', '#FBF5B7']],
        'Nature': [['#11998E', '#38EF7D', '#56AB2F', '#A8E063'], ['#2D6A4F', '#40916C', '#52B788', '#74C69D']],
        'Summer': [['#FF9A8B', '#FF6A88', '#FF99AC', '#FBBC05'], ['#F72585', '#B5179E', '#7209B7', '#560BAD']],
        'Happy': [['#F9D423', '#FF4E50', '#F12711', '#F5AF19'], ['#00FF00', '#FFFF00', '#FFCC00', '#FF3300']],
        'Night': [['#0F0C29', '#302B63', '#24243E', '#FFFFFF'], ['#141E30', '#243B55', '#141E30', '#243B55']],
        'Earth': [['#4B3621', '#6B4423', '#8B5A2B', '#A0522D'], ['#556B2F', '#6B8E23', '#8FBC8F', '#BDB76B']],
        'Retro': [['#E07A5F', '#3D405B', '#81B29A', '#F2CC8F'], ['#FFBE0B', '#FB5607', '#FF006E', '#8338EC']]
    };

    // ২. সাইডবার জেনারেটর
    const catMenu = document.getElementById('categoryMenu');
    categories.forEach(cat => {
        const item = document.createElement('div');
        item.className = 'nav-item';
        item.innerText = cat;
        item.onclick = () => openHunt(cat);
        catMenu.appendChild(item);
    });

    function openHunt(cat) {
        const grid = document.getElementById('huntGrid');
        document.getElementById('modalTitle').innerText = cat + " Selection";
        grid.innerHTML = '';
        const items = huntData[cat] || [];
        items.forEach(p => {
            const card = document.createElement('div');
            card.className = 'hunt-card';
            card.innerHTML = `<div class="c-layer" style="background:${p[0]}"></div>
                              <div class="c-layer" style="background:${p[1]}"></div>
                              <div class="c-layer" style="background:${p[2]}"></div>
                              <div class="c-layer" style="background:${p[3]}"></div>`;
            card.onclick = () => { 
                const rgb = hexToRgb(p[0]); 
                updateUI(rgb.r, rgb.g, rgb.b); 
                closeModal(); 
            };
            grid.appendChild(card);
        });
        document.getElementById('huntModal').style.display = 'block';
    }

    function closeModal() { document.getElementById('huntModal').style.display = 'none'; }

    // ৩. কোর লজিক (Picker & Manual Input)
    function hexToRgb(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? { r: parseInt(result[1], 16), g: parseInt(result[2], 16), b: parseInt(result[3], 16) } : null;
    }

    document.getElementById('upload').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const img = new Image();
            img.onload = () => { canvas.width = img.width; canvas.height = img.height; ctx.drawImage(img, 0, 0); };
            img.src = event.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    });

    canvas.addEventListener('mousedown', function(e) {
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (canvas.width / rect.width);
        const y = (e.clientY - rect.top) * (canvas.height / rect.height);
        const p = ctx.getImageData(x, y, 1, 1).data;
        updateUI(p[0], p[1], p[2]);
    });

    function generateFromInputs() { updateUI(rIn.value, gIn.value, bIn.value); }

    function updateUI(r, g, b) {
        rIn.value = r; gIn.value = g; bIn.value = b;
        const pal = document.getElementById('palette');
        pal.innerHTML = '';
        for (let i = 0; i < 40; i++) {
            let nr, ng, nb;
            let factor = i < 20 ? i/19 : (i-20)/20;
            if(i < 20) { nr = r*factor; ng = g*factor; nb = b*factor; }
            else { nr = r+(255-r)*factor; ng = g+(255-g)*factor; nb = b+(255-b)*factor; }
            const rgb = `${Math.round(nr)},${Math.round(ng)},${Math.round(nb)}`;
            pal.innerHTML += `<div class="color-card" onclick="copy('${rgb}')">
                <div class="color-swatch" style="background:rgb(${rgb})"></div>
                <div class="color-info">${rgb}</div>
            </div>`;
        }
    }

    // ৪. ১০০% ফিক্সড HD ডাউনলোড (৩০০ DPI)
    function downloadHD() {
        const node = document.getElementById('captureArea');
        const scale = 2.5; // High resolution scale

        domtoimage.toPng(node, {
            width: node.offsetWidth * scale,
            height: node.offsetHeight * scale,
            style: {
                transform: 'scale(' + scale + ')',
                transformOrigin: 'top left',
                width: node.offsetWidth + 'px',
                height: node.offsetHeight + 'px'
            }
        })
        .then(function (dataUrl) {
            const link = document.createElement('a');
            link.download = 'Raha-Digital-Palette-' + Date.now() + '.png';
            link.href = dataUrl;
            link.click();
            showToast("HD Image Saved!");
        });
    }

    function copy(t) { navigator.clipboard.writeText(t); showToast("Copied: " + t); }
    function showToast(m) { const t = document.getElementById('copyToast'); t.innerText = m; t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 1500); }

    updateUI(26, 35, 126); // Initial
</script>
</body>
</html>
