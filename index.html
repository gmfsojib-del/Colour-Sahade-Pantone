<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raha Digital Print - Original Restored</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
    <style>
        :root { --primary: #1a237e; --secondary: #2e7d32; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; margin: 0; display: flex; overflow: hidden; }
        
        /* Sidebar Restored */
        .sidebar { width: 280px; background: #fff; height: 100vh; border-right: 2px solid #ddd; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .sidebar h2 { color: var(--primary); text-align: center; font-size: 22px; margin-bottom: 20px; }
        .nav-item { padding: 12px; margin-bottom: 8px; border: 1px solid #eee; border-radius: 6px; cursor: pointer; font-weight: 600; text-align: center; transition: 0.3s; }
        .nav-item:hover { background: var(--primary); color: white; }

        /* Main Content */
        .main { flex: 1; padding: 20px; height: 100vh; overflow-y: auto; }
        .box { background: #fff; padding: 20px; border-radius: 12px; border: 1px solid #ddd; margin-bottom: 20px; text-align: center; }

        /* Input Styles (Hex & RGB) */
        .input-group { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
        .input-field { padding: 10px; border: 2px solid #ccc; border-radius: 8px; font-weight: bold; text-align: center; }
        .rgb-box { width: 60px; }
        .hex-box { width: 120px; }
        .btn-gen { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }

        /* Color Palette Grid (Original Big Style) */
        #downloadArea { background: #fff; padding: 20px; border-radius: 10px; width: 100%; box-sizing: border-box; display: inline-block; }
        .palette-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; margin-top: 15px; }
        .color-card { border: 1px solid #000; background: #fff; border-radius: 8px; overflow: hidden; }
        .swatch { height: 90px; width: 100%; border-bottom: 1px solid #000; }
        .info { padding: 8px 2px; font-size: 14px; font-weight: 900; text-align: center; color: #000; background: #fff; }

        /* Hunt Modal & Layers */
        .modal { display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); }
        .modal-content { background: #fff; margin: 5% auto; padding: 20px; width: 80%; max-height: 80vh; overflow-y: auto; border-radius: 15px; }
        .hunt-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
        .hunt-card { height: 140px; border: 1px solid #999; border-radius: 8px; overflow: hidden; cursor: pointer; }
        .layer { height: 25%; width: 100%; }

        .btn-save { background: var(--secondary); color: white; width: 100%; padding: 18px; border: none; border-radius: 10px; font-size: 20px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        canvas { border: 2px solid #333; margin-top: 15px; max-width: 100%; cursor: crosshair; }
        .history-box { margin-top: 15px; text-align: left; padding: 10px; background: #f9f9f9; border-radius: 8px; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2>RAHA DESIGN</h2>
    <div id="sideMenu"></div>
    <div class="history-box">
        <b>SEARCH HISTORY:</b>
        <div id="historyList" style="font-size: 12px; margin-top: 5px; color: #555;"></div>
        <button onclick="clearHistory()" style="color:red; border:none; background:none; cursor:pointer; font-size:11px; padding:0;">CLEAR HISTORY</button>
    </div>
</div>

<div class="main">
    <div class="box">
        <b>1. PHOTO PICKER / MANUAL INPUT</b>
        <input type="file" id="upload" accept="image/*" style="display:block; margin: 10px auto;">
        
        <div class="input-group">
            <input type="text" id="hexIn" class="input-field hex-box" placeholder="#HEX CODE">
            <input type="number" id="rIn" class="input-field rgb-box" placeholder="R" value="26">
            <input type="number" id="gIn" class="input-field rgb-box" placeholder="G" value="35">
            <input type="number" id="bIn" class="input-field rgb-box" placeholder="B" value="126">
            <button class="btn-gen" onclick="updateFromInputs()">GENERATE</button>
        </div>
        <canvas id="imageCanvas"></canvas>
    </div>

    <div id="downloadArea">
        <div id="palette" class="palette-grid"></div>
    </div>

    <button class="btn-save" onclick="downloadHD()">SAVE AS IMAGE (300 DPI)</button>
</div>

<div id="huntModal" class="modal">
    <div class="modal-content">
        <h2 id="modalTitle">Color Hunt</h2>
        <div id="huntGrid" class="hunt-grid"></div>
        <button onclick="closeModal()" style="margin-top:20px; padding:10px 20px;">CLOSE</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('imageCanvas'), ctx = canvas.getContext('2d');
    const rVal = document.getElementById('rIn'), gVal = document.getElementById('gIn'), bVal = document.getElementById('bIn'), hexVal = document.getElementById('hexIn');

    // ১. আপনার ২০+ প্যালেট এবং ৪টি লেয়ারের ডাটা
    const categories = ["Pastel", "Vintage", "Retro", "Neon", "Gold", "Nature", "Summer", "Happy", "Night", "Earth"];
    const huntData = {
        'Pastel': [['#FFB7B2', '#FFDAC1', '#E2F0CB', '#B5EAD7'], ['#F3E5F5', '#E1F5FE', '#E8F5E9', '#FFFDE7'], ['#B2F7EF', '#EFF7F6', '#F7D1CD', '#E2CFC4'], ['#D4F1F4', '#75E6DA', '#189AB4', '#05445E']],
        'Vintage': [['#634832', '#967E67', '#D4A373', '#FEFAE0'], ['#264653', '#2A9D8F', '#E9C46A', '#F4A261'], ['#582F0E', '#7F4F24', '#936639', '#A68A64']],
        'Gold': [['#D4AF37', '#FFD700', '#CFB53B', '#F5E1A4'], ['#BF953F', '#FCF6BA', '#B38728', '#FBF5B7']]
        // ... এখানে আরও ২০টি প্যালেট অ্যাড করা যাবে
    };

    // ২. সাইডবার মেনু ও হিস্টোরি
    const sideMenu = document.getElementById('sideMenu');
    categories.forEach(cat => {
        const div = document.createElement('div');
        div.className = 'nav-item';
        div.innerText = cat;
        div.onclick = () => openHunt(cat);
        sideMenu.appendChild(div);
    });

    function openHunt(cat) {
        const grid = document.getElementById('huntGrid');
        document.getElementById('modalTitle').innerText = cat + " Hunts";
        grid.innerHTML = '';
        (huntData[cat] || []).forEach(p => {
            const card = document.createElement('div');
            card.className = 'hunt-card';
            card.innerHTML = p.map(c => `<div class="layer" style="background:${c}"></div>`).join('');
            card.onclick = () => { const rgb = hexToRgb(p[0]); updateUI(rgb.r, rgb.g, rgb.b); closeModal(); };
            grid.appendChild(card);
        });
        document.getElementById('huntModal').style.display = 'block';
    }

    function closeModal() { document.getElementById('huntModal').style.display = 'none'; }

    // ৩. কোর লজিক (Hex/RGB/Picker)
    function hexToRgb(hex) {
        const r = parseInt(hex.slice(1,3), 16), g = parseInt(hex.slice(3,5), 16), b = parseInt(hex.slice(5,7), 16);
        return {r, g, b};
    }

    function updateFromInputs() {
        if(hexVal.value.startsWith('#')) {
            const rgb = hexToRgb(hexVal.value);
            updateUI(rgb.r, rgb.g, rgb.b);
        } else {
            updateUI(rVal.value, gVal.value, bVal.value);
        }
    }

    document.getElementById('upload').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = (ev) => {
            const img = new Image();
            img.onload = () => { canvas.width = img.width; canvas.height = img.height; ctx.drawImage(img, 0, 0); };
            img.src = ev.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    });

    canvas.addEventListener('mousedown', (e) => {
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (canvas.width/rect.width), y = (e.clientY - rect.top) * (canvas.height/rect.height);
        const p = ctx.getImageData(x, y, 1, 1).data;
        updateUI(p[0], p[1], p[2]);
    });

    function updateUI(r, g, b) {
        rVal.value = r; gVal.value = g; bVal.value = b;
        const pal = document.getElementById('palette');
        pal.innerHTML = '';
        // ৩৫-৪০টি কালার শেড জেনারেশন (Original Logic)
        for (let i = 0; i < 35; i++) {
            let nr, ng, nb;
            let factor = i / 34;
            nr = Math.round(r * (1 - factor) + 255 * factor);
            ng = Math.round(g * (1 - factor) + 255 * factor);
            nb = Math.round(b * (1 - factor) + 255 * factor);
            const rgb = `${nr},${ng},${nb}`;
            pal.innerHTML += `<div class="color-card">
                <div class="swatch" style="background:rgb(${rgb})"></div>
                <div class="info">${rgb}</div>
            </div>`;
        }
        addToHistory(r, g, b);
    }

    // ৪. ডাউনলোড ফিক্স (যাতে চিকন না হয়)
    function downloadHD() {
        const node = document.getElementById('downloadArea');
        domtoimage.toPng(node, {
            width: node.offsetWidth * 2,
            height: node.offsetHeight * 2,
            style: { transform: 'scale(2)', transformOrigin: 'top left', width: node.offsetWidth + 'px', height: node.offsetHeight + 'px' }
        }).then(url => {
            const link = document.createElement('a');
            link.download = 'Raha-Palette.png';
            link.href = url;
            link.click();
        });
    }

    function addToHistory(r, g, b) {
        const list = document.getElementById('historyList');
        const entry = document.createElement('div');
        entry.innerText = `RGB(${r},${g},${b})`;
        list.prepend(entry);
    }
    function clearHistory() { document.getElementById('historyList').innerHTML = ''; }

    updateUI(26, 35, 126); // Initial
</script>
</body>
</html>
