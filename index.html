<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raha Digital Print - Design Sector</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #1a237e; --secondary: #2e7d32; --ai-color: #00695c; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 0; display: flex; }
        
        /* Sidebar */
        .sidebar-nav { width: 240px; background: #fff; height: 100vh; position: fixed; border-right: 2px solid #ddd; padding: 20px; box-sizing: border-box; z-index: 100; }
        .nav-item { display: flex; align-items: center; padding: 12px; margin-bottom: 10px; border-radius: 8px; cursor: pointer; color: #444; font-weight: bold; transition: 0.3s; border: 1px solid transparent; }
        .nav-item:hover { background: #f0f0f0; border-color: #ccc; }
        .nav-item.active { background: var(--primary); color: white; }
        .nav-icon { margin-right: 10px; font-size: 18px; }

        /* Layout */
        .main-wrapper { margin-left: 240px; width: calc(100% - 240px); padding: 25px; box-sizing: border-box; }
        .main-container { max-width: 1100px; margin: auto; background: #fff; padding: 25px; border-radius: 15px; box-shadow: 0 5px 25px rgba(0,0,0,0.1); }
        .header { text-align: center; font-size: 28px; font-weight: 800; color: var(--primary); margin-bottom: 25px; border-bottom: 4px solid var(--primary); padding-bottom: 10px; text-transform: uppercase; }
        
        .box { padding: 20px; border: 2px solid #ddd; border-radius: 12px; background: #fff; text-align: center; margin-bottom: 20px; }
        #imageCanvas { max-width: 100%; height: auto; display: block; margin: auto; border: 1px solid #ddd; }
        
        /* Modals */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); overflow: auto;}
        .modal-content { background: white; margin: 5% auto; padding: 30px; width: 600px; border-radius: 15px; text-align: center; position: relative; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .close-btn { position: absolute; right: 20px; top: 10px; font-size: 30px; cursor: pointer; color: #666; }
        
        /* Drop Zone */
        .drop-zone { border: 3px dashed #bbb; padding: 40px; border-radius: 10px; background: #f9f9f9; cursor: pointer; transition: 0.3s; margin-bottom: 20px; }
        .drop-zone:hover { background: #f1f1f1; border-color: var(--primary); }
        .preview-box canvas { max-width: 100%; border: 1px solid #ccc; margin-top: 15px; }

        /* Others */
        .btn { padding: 12px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 14px; margin: 5px; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-save { background: var(--secondary); color: white; width: 100%; font-size: 18px; margin-top: 20px; }
        .palette-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; margin-top: 15px; }
        .color-card { border: 1px solid #000; border-radius: 8px; overflow: hidden; cursor: pointer; text-align: center; }
        .color-swatch { height: 60px; }
        .copy-toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 10px 20px; border-radius: 20px; display: none; z-index: 3000; }
    </style>
</head>
<body>

<div class="sidebar-nav">
    <div style="font-weight: 800; font-size: 18px; margin-bottom: 30px; color: var(--primary);">üõ† DESIGN TOOLS</div>
    <div class="nav-item active" onclick="location.reload()"><span class="nav-icon">üé®</span> Color Palette</div>
    <div class="nav-item" onclick="openModal('mockupModal')"><span class="nav-icon">üëï</span> Mockup Preview</div>
    <div class="nav-item" onclick="openModal('upscaleModal')"><span class="nav-icon">üì∑</span> Image Upscale</div>
    <div class="nav-item" onclick="openModal('bgRemoveModal')"><span class="nav-icon">‚úÇÔ∏è</span> Background Remove</div>
</div>

<div class="main-wrapper">
    <div class="main-container">
        <div class="header">Raha Digital Print - Design Sector</div>

        <div class="box">
            <label><b>üé® MAIN COLOR PICKER</b></label><br>
            <input type="file" id="mainUpload" accept="image/*" style="margin: 15px 0;">
            <canvas id="imageCanvas"></canvas>
        </div>

        <div id="downloadArea">
            <div id="palette" class="palette-grid"></div>
        </div>
        <button class="btn btn-save" onclick="downloadPalette()">SAVE PALETTE AS IMAGE</button>
    </div>
</div>

<div id="upscaleModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('upscaleModal')">&times;</span>
        <h2>üöÄ High-Quality Image Upscale</h2>
        <div class="drop-zone" onclick="document.getElementById('upscaleInput').click()">
            <p>‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶¨‡¶æ ‡¶õ‡¶¨‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶°‡ßç‡¶∞‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶® (‡ß® ‡¶ó‡ßÅ‡¶£ ‡¶¨‡ßú ‡¶π‡¶¨‡ßá)</p>
            <input type="file" id="upscaleInput" hidden accept="image/*">
        </div>
        <div id="upscalePreview" class="preview-box"></div>
        <button class="btn btn-primary" id="downloadUpscale" style="display:none;">DOWNLOAD UPSCALED IMAGE</button>
    </div>
</div>

<div id="bgRemoveModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('bgRemoveModal')">&times;</span>
        <h2>‚úÇÔ∏è Background Remover</h2>
        <div class="drop-zone" onclick="document.getElementById('bgInput').click()">
            <p>‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶ó‡ßç‡¶∞‡¶æ‡¶â‡¶®‡ßç‡¶° ‡¶∏‡¶∞‡¶æ‡¶§‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</p>
            <input type="file" id="bgInput" hidden accept="image/*">
        </div>
        <div id="bgPreview" class="preview-box"></div>
        <button class="btn btn-primary" id="downloadBG" style="display:none;">DOWNLOAD TRANSPARENT IMAGE</button>
    </div>
</div>

<div id="mockupModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('mockupModal')">&times;</span>
        <h2>üëï T-Shirt Mockup</h2>
        <div style="background:#eee; padding:20px; border-radius:10px;">
            <svg id="tshirtSVG" viewBox="0 0 100 100" width="200">
                <path d="M90,20 L75,10 C70,8 65,15 65,15 C65,15 60,12 50,12 C40,12 35,15 35,15 C35,15 30,8 25,10 L10,20 L15,40 L25,35 L25,90 L75,90 L75,35 L85,40 L90,20 Z" fill="#1a237e"/>
            </svg>
        </div>
        <p id="mockupColorText">Color: RGB(26, 35, 126)</p>
        <button class="btn btn-primary" onclick="closeModal('mockupModal')">DONE</button>
    </div>
</div>

<div id="copyToast" class="copy-toast">Copied!</div>

<script>
    const canvas = document.getElementById('imageCanvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    let selectedColor = "rgb(26, 35, 126)";

    // Modal Controls
    function openModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    // Main Picker
    document.getElementById('mainUpload').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const img = new Image();
            img.onload = () => {
                canvas.width = img.width; canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
            }
            img.src = event.target.result;
        }
        reader.readAsDataURL(e.target.files[0]);
    });

    canvas.addEventListener('mousedown', function(e) {
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (canvas.width / rect.width);
        const y = (e.clientY - rect.top) * (canvas.height / rect.height);
        const p = ctx.getImageData(x, y, 1, 1).data;
        const rgb = `rgb(${p[0]},${p[1]},${p[2]})`;
        selectedColor = rgb;
        updateUI(p[0], p[1], p[2]);
    });

    function updateUI(r, g, b) {
        document.getElementById('tshirtSVG').querySelector('path').setAttribute('fill', `rgb(${r},${g},${b})`);
        document.getElementById('mockupColorText').innerText = `Color: RGB(${r}, ${g}, ${b})`;
        generatePalette(r, g, b);
    }

    function generatePalette(r, g, b) {
        const pal = document.getElementById('palette');
        pal.innerHTML = '';
        for (let i = 0; i < 20; i++) {
            let f = i / 19;
            let nr = Math.round(r * f), ng = Math.round(g * f), nb = Math.round(b * f);
            const rgb = `${nr},${ng},${nb}`;
            pal.innerHTML += `<div class="color-card" onclick="navigator.clipboard.writeText('${rgb}'); showToast('RGB Copied')">
                <div class="color-swatch" style="background:rgb(${rgb})"></div>
                <div style="font-size:11px; padding:5px;">${rgb}</div>
            </div>`;
        }
    }

    // Upscale Logic
    document.getElementById('upscaleInput').addEventListener('change', function(e) {
        processImage(e.target.files[0], 'upscalePreview', (c) => {
            const factor = 2;
            const tC = document.createElement('canvas');
            const tX = tC.getContext('2d');
            tC.width = c.width * factor; tC.height = c.height * factor;
            tX.imageSmoothingQuality = 'high';
            tX.drawImage(c, 0, 0, tC.width, tC.height);
            
            const btn = document.getElementById('downloadUpscale');
            btn.style.display = 'inline-block';
            btn.onclick = () => {
                const a = document.createElement('a');
                a.download = 'Upscaled.png'; a.href = tC.toDataURL(); a.click();
            };
        });
    });

    // Background Remove Logic
    document.getElementById('bgInput').addEventListener('change', function(e) {
        processImage(e.target.files[0], 'bgPreview', (c) => {
            const tX = c.getContext('2d');
            const imgData = tX.getImageData(0,0,c.width,c.height);
            const data = imgData.data;
            const r = data[0], g = data[1], b = data[2];
            for (let i = 0; i < data.length; i += 4) {
                if (Math.abs(data[i]-r)<40 && Math.abs(data[i+1]-g)<40 && Math.abs(data[i+2]-b)<40) data[i+3] = 0;
            }
            tX.putImageData(imgData, 0,0);
            
            const btn = document.getElementById('downloadBG');
            btn.style.display = 'inline-block';
            btn.onclick = () => {
                const a = document.createElement('a');
                a.download = 'No-BG.png'; a.href = c.toDataURL(); a.click();
            };
        });
    });

    function processImage(file, previewId, callback) {
        const reader = new FileReader();
        reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
                const tempC = document.createElement('canvas');
                tempC.width = img.width; tempC.height = img.height;
                const tempX = tempC.getContext('2d');
                tempX.drawImage(img, 0, 0);
                document.getElementById(previewId).innerHTML = '';
                document.getElementById(previewId).appendChild(tempC);
                callback(tempC);
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }

    function showToast(m) {
        const t = document.getElementById('copyToast'); t.innerText = m;
        t.style.display = 'block'; setTimeout(() => t.style.display='none', 2000);
    }

    function downloadPalette() {
        html2canvas(document.querySelector("#downloadArea")).then(c => {
            const a = document.createElement('a'); a.download = 'Palette.png'; a.href = c.toDataURL(); a.click();
        });
    }

    generatePalette(26, 35, 126);
</script>
</body>
</html>
