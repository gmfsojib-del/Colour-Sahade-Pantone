<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raha Digital Print - Pro Design Sector</title>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        :root { --primary: #1a237e; --secondary: #2e7d32; --ai-color: #00695c; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 0; display: flex; overflow: hidden; }
        
        .video-bg {
            position: fixed; right: 0; bottom: 0; min-width: 100%; min-height: 100%;
            z-index: -1; opacity: 0.15; pointer-events: none; object-fit: cover;
        }

        .sidebar-nav { 
            width: 280px; background: rgba(255, 255, 255, 0.95); height: 100vh; 
            position: fixed; border-right: 2px solid #ddd; padding: 20px; 
            box-sizing: border-box; overflow-y: auto; z-index: 1000; backdrop-filter: blur(10px); 
        }

        .color-group-box {
            border: 1px solid #ddd; border-radius:8px; padding: 12px; background: #fff; margin-top: 10px;
        }
        .color-box-title {
            font-size: 14px; font-weight: 800; color: var(--primary); text-transform: uppercase; margin-bottom: 10px; display: block; text-align: center; border-bottom: 1px solid #eee; padding-bottom: 5px;
        }

        .main-wrapper { 
            margin-left: 280px; width: calc(100% - 280px); 
            height: 100vh; overflow-y: auto; padding: 25px; box-sizing: border-box; position: relative; z-index: 1; 
        }

        .nav-item { display: flex; align-items: center; padding: 10px 15px; margin-bottom: 5px; border-radius: 8px; cursor: pointer; color: #333; font-weight: 600; transition: 0.2s; font-size: 14px; border: 1px solid transparent; }
        .nav-item:hover { background: #f5f5f5; color: var(--primary); }
        .nav-item.active { background: var(--primary); color: white; }

        .main-container { max-width: 1100px; margin: auto; background: rgba(255, 255, 255, 0.95); padding: 25px; border-radius: 15px; box-shadow: 0 5px 25px rgba(0,0,0,0.1); }
        .header { text-align: center; font-size: 26px; font-weight: 800; color: var(--primary); margin-bottom: 25px; border-bottom: 4px solid var(--primary); padding-bottom: 10px; text-transform: uppercase; }
        
        .box { padding: 20px; border: 2px solid #ddd; border-radius: 12px; background: #fff; text-align: center; margin-bottom: 20px; }
        .box-ai { border: 2px solid var(--ai-color); background: #f0fdfa; }

        #picker-container { position: relative; margin-top: 15px; border: 3px solid #333; display: inline-block; cursor: crosshair; line-height: 0; max-width: 100%; border-radius: 8px; overflow: hidden; }
        #imageCanvas { max-width: 100%; height: auto; display: block; }
        
        .rgb-inputs { display: flex; justify-content: center; gap: 8px; margin-top: 15px; flex-wrap: wrap; }
        .rgb-field { width: 60px; padding: 10px; border: 2px solid #ccc; border-radius: 8px; text-align: center; font-weight: 900; font-size: 15px; }
        
        .btn { padding: 14px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; font-size: 15px; text-transform: uppercase; }
        .btn-update { background: var(--primary); color: white; }
        .btn-save { background: var(--secondary); color: white; margin-top: 20px; font-size: 18px; }
        .btn-save:active { transform: scale(0.98); background: #1b5e20; }
        
        .palette-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 12px; margin-top: 15px; }
        .color-card { border: 1px solid #000; background: #fff; border-radius: 10px; overflow: hidden; cursor: pointer; }
        .color-swatch { width: 100%; height: 80px; border-bottom: 1px solid #000; }
        .color-info { padding: 5px 2px; font-size: 12px; font-weight: 900; text-align: center; color: #000; }
        
        /* Hunt Data Grid */
        #huntGrid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .hunt-card { background: #fff; border-radius: 10px; overflow: hidden; box-shadow: 0 3px 8px rgba(0,0,0,0.1); cursor: pointer; height: 160px; display: flex; flex-direction: column; border: 1px solid #eee; }
        .c-layer { width: 100%; transition: 0.2s; position: relative; height: 25%; }

        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-content { background: white; margin: 2% auto; padding: 25px; width: 90%; max-width: 800px; border-radius: 15px; text-align: center; position: relative; max-height: 90vh; overflow-y: auto; }
        .close-btn { position: absolute; right: 20px; top: 10px; font-size: 30px; cursor: pointer; color: #333; }
        
        .copy-toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 12px 25px; border-radius: 30px; display: none; z-index: 3000; font-weight: bold; }
    </style>
</head>
<body>

<video autoplay muted loop class="video-bg">
    <source src="https://assets.mixkit.co/videos/preview/mixkit-abstract-color-fluid-motion-background-4416-large.mp4" type="video/mp4">
</video>

<div class="sidebar-nav">
    <div style="text-align: center; padding: 10px; margin-bottom: 10px;">
        <strong style="font-size: 20px; color: var(--primary);">RAHA DESIGN-Tools</strong>
    </div>
    
    <div class="color-group-box">
        <span class="color-box-title">Color Categories</span>
        <div id="categoryMenu"></div>
    </div>
</div>

<div class="main-wrapper">
    <div class="main-container">
        <div class="header">Raha Digital Print - Design Sector</div>

        <div class="box">
            <label><b>1. PHOTO PICKER (MANUAL)</b></label>
            <input type="file" id="upload" accept="image/*" style="display:block; margin: 10px auto;">
            <div id="picker-container">
                <canvas id="imageCanvas"></canvas>
            </div>
        </div>

        <div class="box box-ai">
            <label style="color: var(--ai-color);"><b>âœ¨ AI COLOR MATCHER</b></label>
            <div class="rgb-inputs">
                <input type="text" id="ai_hex" style="width: 100px; padding: 10px; border: 2px solid #ccc; border-radius: 8px; text-align: center; font-weight: 900;" placeholder="#HEX">
            </div>
            <button class="btn" style="background: var(--ai-color); color: white; margin-top: 15px;" onclick="generate8AIColors()">GENERATE 8 UNIQUE COLORS</button>
            <div id="aiMatchingResult" class="palette-grid"></div>
        </div>

        <div class="box">
            <label><b>3. INPUT RGB CODE</b></label>
            <div class="rgb-inputs">
                <input type="number" id="r" class="rgb-field" value="26">
                <input type="number" id="g" class="rgb-field" value="35">
                <input type="number" id="b" class="rgb-field" value="126">
            </div>
            <button class="btn btn-update" onclick="generateFromInputs()">GENERATE PALETTE</button>
        </div>

        <div id="downloadArea" style="padding: 20px; background: white; border: 1px solid #ddd; border-radius: 12px; margin-top: 20px;">
            <h3 style="text-align: center; margin-bottom: 20px; color: #1a237e;">Premium Digital Palette</h3>
            <div id="palette" class="palette-grid"></div>
        </div>

        <button class="btn btn-save" id="downloadBtn" onclick="downloadImage()">SAVE AS IMAGE (300 DPI)</button>
    </div>
</div>

<div id="huntModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('huntModal')">&times;</span>
        <h2 id="huntModalTitle">ðŸŒˆ Explore Hunts</h2>
        <div id="huntGrid"></div>
        <button class="btn btn-update" style="margin-top: 20px;" onclick="closeModal('huntModal')">DONE</button>
    </div>
</div>

<div id="copyToast" class="copy-toast">Code Copied!</div>

<script>
    // --- Configuration & Data ---
    const canvas = document.getElementById('imageCanvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    const rIn = document.getElementById('r');
    const gIn = document.getElementById('g');
    const bIn = document.getElementById('b');

    const categories = ["Pastel", "Vintage", "Retro", "Neon", "Gold", "Nature", "Summer", "Happy", "Night", "Earth"];

    // Full Hunt Data Restored
    const huntData = {
        'Pastel': [['#FFB7B2', '#FFDAC1', '#E2F0CB', '#B5EAD7'], ['#F3E5F5', '#E1F5FE', '#E8F5E9', '#FFFDE7'], ['#B2F7EF', '#EFF7F6', '#F7D1CD', '#E2CFC4'], ['#FCE1E4', '#FCF4DD', '#DDEDEA', '#DAEAF6'], ['#E8D7F1', '#D3BCC0', '#A5668B', '#69306D'], ['#F08080', '#F4978E', '#F8AD9D', '#FBC4AB'], ['#FF99C8', '#FCF6BD', '#D0F4DE', '#A9DEF9'], ['#E4C1F9', '#D0F4DE', '#FCF6BD', '#FF99C8'], ['#F6EAC2', '#FFD4B2', '#FFBFA3', '#FFADAD'], ['#A0C4FF', '#BDB2FF', '#FFC6FF', '#FFFFFC'], ['#DEE2FF', '#E8E8E8', '#FEEAFA', '#F1F1F1'], ['#B9FBC0', '#98F5E1', '#8EECF5', '#A3C4F3'], ['#FFB3BA', '#FFDFBA', '#FFFFBA', '#BAFFC9'], ['#BAE1FF', '#D1D1D1', '#E2F0CB', '#FFDAC1'], ['#FF9AA2', '#FFB7B2', '#FFDAC1', '#E2F0CB'], ['#C7CEEA', '#B5EAD7', '#E2F0CB', '#FFDAC1'], ['#FAD0C4', '#FFD1FF', '#E0C3FC', '#8EC5FC'], ['#FFDEE9', '#B5FFFC', '#FFFFFF', '#D9AFD9'], ['#A18CD1', '#FBC2EB', '#8FD3F4', '#84FAB0'], ['#FBED64', '#7AFFAF', '#7158E2', '#CD84F1']],
        'Vintage': [['#634832', '#967E67', '#D4A373', '#FEFAE0'], ['#264653', '#2A9D8F', '#E9C46A', '#F4A261'], ['#582F0E', '#7F4F24', '#936639', '#A68A64'], ['#B6AD90', '#C2C5AA', '#A4AC86', '#656D4A'], ['#333D29', '#414833', '#656D4A', '#A4AC86'], ['#7D4F50', '#D1BE9C', '#AA998F', '#E0D8DE'], ['#2C3E50', '#E67E22', '#ECF0F1', '#95A5A6'], ['#1A1A1A', '#4A4A4A', '#9B9B9B', '#D8D8D8'], ['#3E2723', '#5D4037', '#8D6E63', '#D7CCC8'], ['#1B5E20', '#388E3C', '#66BB6A', '#C8E6C9'], ['#827397', '#4D4C7D', '#363062', '#E9D5CA'], ['#433520', '#025955', '#00917C', '#FDE8CD'], ['#5F4B32', '#967E67', '#D4A373', '#FEFAE0'], ['#403D39', '#CCC5B9', '#FFFCF2', '#EB5E28'], ['#252422', '#403D39', '#CCC5B9', '#FFFCF2'], ['#1D3557', '#457B9D', '#A8DADC', '#F1FAEE'], ['#6D597A', '#B56576', '#E56B6F', '#EAAC8B'], ['#283618', '#606C38', '#FEFAE0', '#DDA15E'], ['#540B0E', '#9E2A2B', '#E09F3E', '#FFF3B0'], ['#3D5A80', '#98C1D9', '#E0FBFC', '#EE6C4D']],
        'Retro': [['#E07A5F', '#3D405B', '#81B29A', '#F2CC8F'], ['#FFBE0B', '#FB5607', '#FF006E', '#8338EC'], ['#264653', '#2A9D8F', '#E9C46A', '#F4A261'], ['#D00000', '#FFBA08', '#3F88C5', '#032B43'], ['#606C38', '#283618', '#FEFAE0', '#DDA15E'], ['#EF476F', '#FFD166', '#06D6A0', '#118AB2'], ['#2B2D42', '#8D99AE', '#EDF2F4', '#EF233C'], ['#003049', '#D62828', '#F77F00', '#FCBF49'], ['#7209B7', '#3F37C9', '#4361EE', '#4CC9F0'], ['#FF9F1C', '#FFBF69', '#FFFFFF', '#CBF3F0'], ['#1A535C', '#4ECDC4', '#F7FFF7', '#FF6B6B'], ['#FFBC42', '#D81159', '#8F2D56', '#218380'], ['#50514F', '#F25F5C', '#FFE066', '#247BA0'], ['#70D6FF', '#FF70A6', '#FF9770', '#FFD670'], ['#05668D', '#028090', '#00A896', '#02C39A'], ['#F45B69', '#456990', '#E4FDE1', '#114B5F'], ['#D7263D', '#F46036', '#2E294E', '#1B998B'], ['#3D348B', '#7678ED', '#F7B801', '#F18701'], ['#8E9AAF', '#CBC0D3', '#EFD3D7', '#FEEAFA'], ['#22223B', '#4A4E69', '#9A8C98', '#C9ADA7']],
        'Neon': [['#00F5FF', '#00FF41', '#FF00FF', '#FFFF00'], ['#FF3131', '#FF5E13', '#77EE11', '#08F7FE'], ['#FF0055', '#00FF99', '#00CCFF', '#FFFF00'], ['#BF00FF', '#FF00BF', '#00FFBF', '#FFBF00'], ['#39FF14', '#FF1493', '#00BFFF', '#FFD700'], ['#7FFF00', '#FF00FF', '#00FFFF', '#FF4500'], ['#000000', '#FF0000', '#FFFB00', '#00FF00'], ['#05FFA1', '#B967FF', '#05B2FF', '#FF4848'], ['#BC13FE', '#FF0092', '#FFCA20', '#E50914'], ['#FF00FF', '#00FFFF', '#FFFF00', '#00FF00'], ['#4DEEEA', '#74EE15', '#FFE700', '#F000FF'], ['#001EFF', '#BD00FF', '#D600FF', '#FF00B0'], ['#FFEA00', '#00E5FF', '#00FF00', '#FF00FF'], ['#00E5FF', '#00FF00', '#FF00FF', '#FF0000'], ['#FF1493', '#00CED1', '#FFD700', '#32CD32'], ['#FF4500', '#1E90FF', '#FFFF00', '#00FF7F'], ['#FF69B4', '#00FF00', '#00FFFF', '#DA70D6'], ['#ADFF2F', '#FF00FF', '#FF1493', '#00BFFF'], ['#FF0000', '#00FF00', '#0000FF', '#FFFF00'], ['#00FFFF', '#FF00FF', '#FFFF00', '#000000']],
        'Gold': [['#D4AF37', '#FFD700', '#CFB53B', '#F5E1A4'], ['#BF953F', '#FCF6BA', '#B38728', '#FBF5B7'], ['#C5A059', '#D7BE82', '#7A5C12', '#F1E5AC'], ['#E1C16E', '#CD7F32', '#996515', '#B8860B'], ['#DAA520', '#FFD700', '#EEE8AA', '#FAFAD2'], ['#8A6623', '#C19A6B', '#E5AA70', '#E1C699'], ['#D4AF37', '#996515', '#FFD700', '#000000'], ['#B8860B', '#FFD700', '#DAA520', '#333333'], ['#E6BE8A', '#8E7618', '#A98B11', '#BBA53D'], ['#C5B358', '#D4AF37', '#E6BE8A', '#A67C00'], ['#D9B611', '#F2D06B', '#F2E8DF', '#BF9B30'], ['#FFD700', '#E5C100', '#C0A000', '#998000'], ['#FFD700', '#FFCC33', '#FF9900', '#FF6600'], ['#D4AF37', '#C0C0C0', '#B87333', '#FFD700'], ['#FFD700', '#C5B358', '#D4AF37', '#996515'], ['#D4AF37', '#FFD700', '#FFDF00', '#FFDB58'], ['#E5C100', '#FFD700', '#FFFF00', '#FDEE00'], ['#FFD700', '#EEDC82', '#DAA520', '#B8860B'], ['#D4AF37', '#996515', '#B8860B', '#DAA520'], ['#FFD700', '#C5A059', '#7A5C12', '#4D3B11']],
        'Nature': [['#11998E', '#38EF7D', '#56AB2F', '#A8E063'], ['#2D6A4F', '#40916C', '#52B788', '#74C69D'], ['#004B23', '#007200', '#008000', '#38B000'], ['#002109', '#003E1F', '#005F39', '#007F5F'], ['#212529', '#343A40', '#495057', '#ADB5BD'], ['#355070', '#6D597A', '#B56576', '#E56B6F'], ['#1A535C', '#4ECDC4', '#F7FFF7', '#FF6B6B'], ['#264653', '#2A9D8F', '#E9C46A', '#F4A261'], ['#011627', '#FDFFFC', '#2EC4B6', '#E71D36'], ['#50514F', '#F25F5C', '#FFE066', '#247BA0'], ['#2B2D42', '#8D99AE', '#EDF2F4', '#EF233C'], ['#1D3557', '#457B9D', '#A8DADC', '#F1FAEE'], ['#606C38', '#283618', '#FEFAE0', '#DDA15E'], ['#22577A', '#38A3A5', '#57CC99', '#80ED99'], ['#3C0919', '#7D1D3F', '#D11149', '#E63946'], ['#003049', '#D62828', '#F77F00', '#FCBF49'], ['#007F5F', '#2B9348', '#55A630', '#80B918'], ['#FF9F1C', '#FFBF69', '#FFFFFF', '#CBF3F0'], ['#7209B7', '#3F37C9', '#4361EE', '#4CC9F0'], ['#F94144', '#F3722C', '#F8961E', '#F9C74F']],
        'Summer': [['#FF9A8B', '#FF6A88', '#FF99AC', '#FBBC05'], ['#F72585', '#B5179E', '#7209B7', '#560BAD'], ['#480CA8', '#3F37C9', '#4361EE', '#4CC9F0'], ['#4361EE', '#4895EF', '#4CC9F0', '#4EA8DE'], ['#FFBE0B', '#FB5607', '#FF006E', '#8338EC'], ['#3A86FF', '#00B4D8', '#90E0EF', '#CAF0F8'], ['#FF4D6D', '#FF758F', '#FF85A1', '#FFB3C1'], ['#FFCCD5', '#FFF0F3', '#FF85A1', '#FF4D6D'], ['#0077B6', '#0096C7', '#00B4D8', '#48CAE4'], ['#ADE8F4', '#CAF0F8', '#0077B6', '#023E8A'], ['#FF006E', '#8338EC', '#3A86FF', '#00B4D8'], ['#FF99C8', '#FCF6BD', '#D0F4DE', '#A9DEF9'], ['#E4C1F9', '#D0F4DE', '#FCF6BD', '#FF99C8'], ['#FFADAD', '#FFD6A5', '#FDFFB6', '#CAFFBF'], ['#9BF6FF', '#A0C4FF', '#BDB2FF', '#FFC6FF'], ['#FF7B00', '#FF8800', '#FF9500', '#FFA200'], ['#FFAA00', '#FFB700', '#FFC300', '#FFD000'], ['#FFDD00', '#FFEA00', '#2A9D8F', '#E9C46A'], ['#F4A261', '#E76F51', '#264653', '#2A9D8F'], ['#E9C46A', '#F4A261', '#E76F51', '#FFFFFF']],
        'Happy': [['#F9D423', '#FF4E50', '#F12711', '#F5AF19'], ['#FF00CC', '#3333FF', '#FF00CC', '#3333FF'], ['#00FF00', '#FFFF00', '#00FF00', '#FFFF00'], ['#FF9900', '#FF0000', '#FF9900', '#FF0000'], ['#6600FF', '#FF0066', '#6600FF', '#FF0066'], ['#00FFFF', '#FF00FF', '#00FFFF', '#FF00FF'], ['#FFCC00', '#FF3300', '#FFCC00', '#FF3300'], ['#33CC33', '#0066CC', '#33CC33', '#0066CC'], ['#CC00CC', '#FF9900', '#CC00CC', '#FF9900'], ['#00CCFF', '#FFCC00', '#00CCFF', '#FFCC00'], ['#FFFF00', '#FF00FF', '#FFFF00', '#FF00FF'], ['#FF3399', '#33FFCC', '#FF3399', '#33FFCC'], ['#66FF33', '#FF3366', '#66FF33', '#FF3366'], ['#3399FF', '#FFCC33', '#3399FF', '#FFCC33'], ['#FF6600', '#00CC66', '#FF6600', '#00CC66'], ['#CC33FF', '#FFCC00', '#CC33FF', '#FFCC00'], ['#00FF99', '#FF3399', '#00FF99', '#FF3399'], ['#FFCC33', '#3399FF', '#FFCC33', '#3399FF'], ['#FF00FF', '#00FFFF', '#FF00FF', '#00FFFF'], ['#FF3300', '#00FF00', '#FF3300', '#00FF00']],
        'Night': [['#0F0C29', '#302B63', '#24243E', '#FFFFFF'], ['#141E30', '#243B55', '#141E30', '#243B55'], ['#000000', '#434343', '#000000', '#434343'], ['#232526', '#414345', '#232526', '#414345'], ['#0F2027', '#203A43', '#2C5364', '#0F2027'], ['#373B44', '#4286F4', '#373B44', '#4286F4'], ['#1E3C72', '#2A5298', '#1E3C72', '#2A5298'], ['#2C3E50', '#000000', '#2C3E50', '#000000'], ['#4B6CB7', '#182848', '#4B6CB7', '#182848'], ['#000000', '#E74C3C', '#000000', '#E74C3C'], ['#141E30', '#243B55', '#141E30', '#243B55'], ['#232526', '#414345', '#232526', '#414345'], ['#0F2027', '#203A43', '#2C5364', '#0F2027'], ['#373B44', '#4286F4', '#373B44', '#4286F4'], ['#1E3C72', '#2A5298', '#1E3C72', '#2A5298'], ['#2C3E50', '#000000', '#2C3E50', '#000000'], ['#4B6CB7', '#182848', '#4B6CB7', '#182848'], ['#000000', '#E74C3C', '#000000', '#E74C3C'], ['#111111', '#333333', '#555555', '#777777'], ['#000011', '#000033', '#000055', '#000077']],
        'Earth': [['#4B3621', '#6B4423', '#8B5A2B', '#A0522D'], ['#556B2F', '#6B8E23', '#8FBC8F', '#BDB76B'], ['#8B4513', '#A0522D', '#CD853F', '#D2B48C'], ['#2F4F4F', '#556B2F', '#8B4513', '#BC8F8F'], ['#D2B48C', '#DEB887', '#F5F5DC', '#FAEBD7'], ['#BC8F8F', '#C0C0C0', '#D3D3D3', '#E0E0E0'], ['#8FBC8F', '#98FB98', '#00FF7F', '#00FA9A'], ['#CD853F', '#D2B48C', '#DEB887', '#F5DEB3'], ['#556B2F', '#6B8E23', '#9ACD32', '#ADFF2F'], ['#8B4513', '#A0522D', '#B8860B', '#DAA520'], ['#4B3621', '#6B4423', '#8B5A2B', '#A0522D'], ['#556B2F', '#6B8E23', '#8FBC8F', '#BDB76B'], ['#8B4513', '#A0522D', '#CD853F', '#D2B48C'], ['#2F4F4F', '#556B2F', '#8B4513', '#BC8F8F'], ['#D2B48C', '#DEB887', '#F5F5DC', '#FAEBD7'], ['#BC8F8F', '#C0C0C0', '#D3D3D3', '#E0E0E0'], ['#8FBC8F', '#98FB98', '#00FF7F', '#00FA9A'], ['#CD853F', '#D2B48C', '#DEB887', '#F5DEB3'], ['#556B2F', '#6B8E23', '#9ACD32', '#ADFF2F'], ['#8B4513', '#A0522D', '#B8860B', '#DAA520']]
    };

    // Initialize Categories
    const catMenu = document.getElementById('categoryMenu');
    categories.forEach(cat => {
        const item = document.createElement('div');
        item.className = 'nav-item';
        item.innerHTML = cat;
        item.onclick = () => {
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            item.classList.add('active');
            openHuntModal(cat);
        };
        catMenu.appendChild(item);
    });

    function openHuntModal(cat) {
        const modal = document.getElementById('huntModal');
        const grid = document.getElementById('huntGrid');
        document.getElementById('huntModalTitle').innerHTML = `ðŸŒˆ Explore ${cat.toUpperCase()} Hunts`;
        grid.innerHTML = '';
        const items = huntData[cat];
        if(items) {
            items.forEach(p => {
                grid.innerHTML += `<div class="hunt-card" onclick="copyHex('${p[0]}')">
                    <div class="c-layer" style="background:${p[0]}"></div>
                    <div class="c-layer" style="background:${p[1]}"></div>
                    <div class="c-layer" style="background:${p[2]}"></div>
                    <div class="c-layer" style="background:${p[3]}"></div>
                </div>`;
            });
        }
        modal.style.display = 'block';
    }

    // --- Core Logic ---
    function rgbToHex(r, g, b) {
        return "#" + [r, g, b].map(x => {
            const hex = parseInt(x).toString(16).toUpperCase();
            return hex.length === 1 ? '0' + hex : hex;
        }).join('');
    }

    function hexToRgb(hex) {
        hex = hex.replace('#', '');
        if (hex.length === 3) hex = hex.split('').map(s => s + s).join('');
        let bigint = parseInt(hex, 16);
        return { r: (bigint >> 16) & 255, g: (bigint >> 8) & 255, b: bigint & 255 };
    }

    function generate8AIColors() {
        let hVal = document.getElementById('ai_hex').value;
        if (!hVal.startsWith('#')) hVal = '#' + hVal;
        const res = hexToRgb(hVal);
        if(isNaN(res.r)) return showToast("Invalid Hex!");

        const aiGrid = document.getElementById('aiMatchingResult');
        aiGrid.innerHTML = '';
        
        for(let i=0; i<8; i++) {
            let nr = Math.min(255, Math.max(0, res.r + (Math.random() * 60 - 30)));
            let ng = Math.min(255, Math.max(0, res.g + (Math.random() * 60 - 30)));
            let nb = Math.min(255, Math.max(0, res.b + (Math.random() * 60 - 30)));
            const rgb = `${Math.round(nr)},${Math.round(ng)},${Math.round(nb)}`;
            const hex = rgbToHex(nr, ng, nb);
            aiGrid.innerHTML += `<div class="color-card" onclick="copyCode('${rgb}')" ondblclick="copyHex('${hex}')">
                <div class="color-swatch" style="background:rgb(${rgb})"></div>
                <div class="color-info">${rgb}</div>
            </div>`;
        }
        updateUI(res.r, res.g, res.b);
    }

    document.getElementById('upload').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
                canvas.width = img.width; canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
            }
            img.src = event.target.result;
        }
        reader.readAsDataURL(e.target.files[0]);
    });

    canvas.addEventListener('mousedown', function(e) {
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (canvas.width / rect.width);
        const y = (e.clientY - rect.top) * (canvas.height / rect.height);
        const p = ctx.getImageData(x, y, 1, 1).data;
        updateUI(p[0], p[1], p[2]);
    });

    function updateUI(r, g, b) {
        rIn.value = r; gIn.value = g; bIn.value = b;
        generatePalette(r, g, b);
    }

    function generateFromInputs() { updateUI(rIn.value, gIn.value, bIn.value); }

    function generatePalette(r, g, b) {
        const pal = document.getElementById('palette');
        pal.innerHTML = '';
        for (let i = 0; i < 40; i++) {
            let nr, ng, nb;
            let factor = i < 20 ? i/19 : (i-20)/20;
            if(i < 20) { nr = r*factor; ng = g*factor; nb = b*factor; }
            else { nr = r+(255-r)*factor; ng = g+(255-g)*factor; nb = b+(255-b)*factor; }
            const r_val = Math.round(nr); const g_val = Math.round(ng); const b_val = Math.round(nb);
            const rgb = `${r_val},${g_val},${b_val}`; const hex = rgbToHex(r_val, g_val, b_val);
            pal.innerHTML += `<div class="color-card" onclick="copyCode('${rgb}')" ondblclick="copyHex('${hex}')">
                <div class="color-swatch" style="background:rgb(${rgb})"></div>
                <div class="color-info">${rgb}</div>
            </div>`;
        }
    }

    function closeModal(id) { document.getElementById(id).style.display = 'none'; }

    // --- FIXED DOWNLOAD FUNCTION ---
    function downloadImage() {
        const area = document.querySelector("#downloadArea");
        const btn = document.getElementById("downloadBtn");
        
        btn.innerText = "GENERATING IMAGE...";
        btn.disabled = true;

        // html2canvas rendering with better settings
        html2canvas(area, {
            scale: 3, // High quality 300 DPI approx
            useCORS: true,
            allowTaint: true,
            backgroundColor: "#ffffff"
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'Raha-Digital-Palette-' + Date.now() + '.png';
            link.href = canvas.toDataURL("image/png", 1.0);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            btn.innerText = "SAVE AS IMAGE (300 DPI)";
            btn.disabled = false;
            showToast("Palette Downloaded Successfully!");
        }).catch(err => {
            console.error("Download Error: ", err);
            btn.innerText = "ERROR! TRY AGAIN";
            btn.disabled = false;
            alert("Download failed. Please try again.");
        });
    }

    function copyCode(t) { navigator.clipboard.writeText(t); showToast("RGB Copied: " + t); }
    function copyHex(t) { navigator.clipboard.writeText(t); showToast("HEX Copied: " + t); }
    function showToast(m) { const t = document.getElementById('copyToast'); t.innerText = m; t.style.display = 'block'; setTimeout(() => t.style.display = 'none', 1500); }

    // Initial load
    generatePalette(26, 35, 126);
</script>
</body>
</html>
