<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <title>প্রিমিয়াম ডাইনামিক কালার মাস্টার</title>
    <script src="html2canvas.min.js"></script>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #eceff1; padding: 20px; }
        .main-container { max-width: 1100px; margin: auto; background: #fff; padding: 30px; border-radius: 20px; box-shadow: 0 15px 50px rgba(0,0,0,0.15); text-align: center; }
        
        .header { font-size: 26px; font-weight: 800; color: #1a237e; margin-bottom: 25px; text-transform: uppercase; letter-spacing: 1px; }

        .control-panel { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .input-box { padding: 20px; border: 1px solid #cfd8dc; border-radius: 15px; background: #f8f9fa; transition: 0.3s; }
        .input-box:hover { border-color: #1a237e; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }

        .rgb-inputs { display: flex; justify-content: center; gap: 12px; margin-top: 15px; }
        .rgb-field { width: 70px; }
        .rgb-field label { display: block; font-weight: bold; font-size: 14px; margin-bottom: 8px; color: #455a64; }
        .rgb-field input { width: 100%; padding: 10px; border: 2px solid #b0bec5; border-radius: 8px; font-weight: bold; text-align: center; font-size: 16px; }
        .rgb-field input:focus { border-color: #1a237e; outline: none; }

        .btn { padding: 14px 25px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.3s; width: 100%; margin-top: 15px; }
        .btn-blue { background: #1a237e; color: white; }
        .btn-blue:hover { background: #0d47a1; }
        .btn-green { background: #2e7d32; color: white; margin-top: 30px; font-size: 20px; display: none; height: 65px; box-shadow: 0 4px 15px rgba(46, 125, 50, 0.3); }

        #imageCanvas { border: 5px solid #263238; border-radius: 12px; cursor: crosshair; max-width: 100%; height: auto; margin-top: 20px; display: block; margin-left: auto; margin-right: auto; background: #fff; }
        
        #downloadArea { background: white; padding: 25px; margin-top: 30px; border: 1px solid #ddd; border-radius: 5px; }
        .palette-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; }
        .color-card { border: 1px solid #000; background: #fff; transition: 0.2s; }
        .color-swatch { width: 100%; height: 110px; border-bottom: 1px solid #000; }
        .color-info { padding: 12px; font-size: 15px; font-weight: bold; color: #000; font-family: monospace; }

        .upload-label { font-weight: bold; font-size: 16px; color: #1a237e; display: block; margin-bottom: 10px; }
        input[type="file"] { font-size: 14px; color: #546e7a; }
    </style>
</head>
<body>

<div class="main-container">
    <div class="header">Premium RGB Shade Generator</div>
    
    <div class="control-panel">
        <div class="input-box">
            <label class="upload-label">UPLOAD PHOTO</label>
            <input type="file" id="upload" accept="image/*">
        </div>

        <div class="input-box">
            <label class="upload-label">MANUAL RGB CHANNELS</label>
            <div class="rgb-inputs">
                <div class="rgb-field"><label>R</label><input type="number" id="inR" min="0" max="255" value="100"></div>
                <div class="rgb-field"><label>G</label><input type="number" id="inG" min="0" max="255" value="150"></div>
                <div class="rgb-field"><label>B</label><input type="number" id="inB" min="0" max="255" value="200"></div>
            </div>
            <button class="btn btn-blue" onclick="processRGBInput()">GENERATE PREMIUM SHADES</button>
        </div>
    </div>

    <canvas id="imageCanvas"></canvas>

    <div id="downloadArea">
        <div class="palette-grid" id="palette"></div>
    </div>

    <button class="btn btn-green" id="downloadBtn" onclick="downloadImage()">SAVE AS 300 DPI IMAGE</button>
</div>

<script>
    const upload = document.getElementById('upload');
    const canvas = document.getElementById('imageCanvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });
    const palette = document.getElementById('palette');
    const downloadBtn = document.getElementById('downloadBtn');

    upload.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
                const maxW = 800;
                const scale = Math.min(maxW / img.width, 1);
                canvas.width = img.width * scale;
                canvas.height = img.height * scale;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                palette.innerHTML = "";
                downloadBtn.style.display = "none";
            }
            img.src = event.target.result;
        }
        reader.readAsDataURL(file);
    };

    canvas.addEventListener('mousedown', function(e) {
        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX - rect.left) * (canvas.width / rect.width);
        const y = (e.clientY - rect.top) * (canvas.height / rect.height);
        const pixel = ctx.getImageData(x, y, 1, 1).data;
        generatePremiumShades(pixel[0], pixel[1], pixel[2]);
    });

    function processRGBInput() {
        const r = parseInt(document.getElementById('inR').value) || 0;
        const g = parseInt(document.getElementById('inG').value) || 0;
        const b = parseInt(document.getElementById('inB').value) || 0;
        generatePremiumShades(r, g, b);
    }

    function generatePremiumShades(r, g, b) {
        palette.innerHTML = "";
        
        // অ্যালগরিদম: এটি ২৫৫ থেকে ০ পর্যন্ত রেঞ্জকে সূক্ষ্মভাবে ভাগ করে কমপক্ষে ২০টি শেড নিশ্চিত করবে
        // যদি কালার খুব লাইট হয় তবে ডার্কের দিকে বেশি যাবে, ডার্ক হলে লাইটের দিকে বেশি যাবে।
        
        let shades = [];
        let totalSteps = 45; // আমরা ৪৫টি পর্যন্ত পজিশন চেক করবো

        for (let i = 0; i < totalSteps; i++) {
            let offset = (i - (totalSteps/2.5)) * 6; // সূক্ষ্ম গ্যাপ তৈরির জন্য
            
            let nr = Math.max(0, Math.min(255, r + offset));
            let ng = Math.max(0, Math.min(255, g + offset));
            let nb = Math.max(0, Math.min(255, b + offset));

            let colorKey = `${nr},${ng},${nb}`;
            
            // ডুপ্লিকেট কালার এবং পিওর হোয়াইট/ব্ল্যাক ফিল্টার (যদি অনেক বেশি হয়ে যায়)
            if (!shades.includes(colorKey)) {
                shades.push(colorKey);
                
                const card = document.createElement('div');
                card.className = 'color-card';
                card.innerHTML = `
                    <div class="color-swatch" style="background: rgb(${nr},${ng},${nb})"></div>
                    <div class="color-info">${nr}, ${ng}, ${nb}</div>
                `;
                palette.appendChild(card);
            }
        }
        
        // কমপক্ষে ২০টি শেড নিশ্চিত করার জন্য গ্রিড আপডেট
        downloadBtn.style.display = "block";
    }

    function downloadImage() {
        const area = document.getElementById('downloadArea');
        html2canvas(area, { 
            scale: 3, 
            useCORS: true, 
            backgroundColor: "#ffffff",
            logging: false 
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = 'Premium_Palette_300DPI.png';
            link.href = canvas.toDataURL("image/png");
            link.click();
        });
    }
</script>

</body>
</html>